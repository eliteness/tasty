<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <title>Thena Strategy</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Every trade buys veTHE. veTHE rewards buy and burn theSTRAT. Built on Thena.">
    <meta property="og:title" content="Thena Strategy">
    <meta property="og:description" content="Every trade buys veTHE. veTHE rewards buy and burn theSTRAT. Built on Thena.">
    <meta property="og:image" content="https://eliteness.network/tasty/thenastrat_banner_1.png">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Thena Strategy">
    <meta name="twitter:description" content="Every trade buys veTHE. veTHE rewards buy and burn THESTRAT. Built on Thena.">
    <meta name="twitter:image" content="https://eliteness.network/tasty/thenastrat_banner_1.png">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.2/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700;800&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                        mono: ['Courier Prime', 'monospace'],
                    },
                    colors: {
                        brand: {
                            bg: '#05010a',
                            card: '#12081f',
                            border: '#2d1b4e',
                            primary: '#8E24AA',
                            secondary: '#AB47BC',
                            accent: '#d946ef',
                        },
                        success: '#00E676',
                        danger: '#FF1744',
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'pulse-glow': 'pulseGlow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        pulseGlow: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '.5' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #05010a;
            background-image:
                radial-gradient(circle at 0% 0%, rgba(142, 36, 170, 0.1), transparent 40%),
                radial-gradient(circle at 100% 100%, rgba(217, 70, 239, 0.05), transparent 40%);
            background-attachment: fixed;
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        .glass-panel {
            background: rgba(18, 8, 31, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .input-box {
            background: #0a0510;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }
        .input-box:focus-within {
            background: #0f0518;
            border-color: #8E24AA;
        }

        .settings-container {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 0;
        }
        .settings-container.open {
            max-height: 120px;
            opacity: 1;
            margin-bottom: 1rem;
            padding: 1rem;
            border-width: 1px;
        }
        .rotate-gear {
            transition: transform 0.4s ease;
        }
        .rotate-gear.active {
            transform: rotate(90deg);
        }

        .route-path-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
        }
        .route-line-bg {
            position: absolute;
            left: 20px; right: 20px; top: 50%;
            height: 2px;
            background: #2d1b4e;
            z-index: 0;
        }
        .route-line-active {
            position: absolute;
            left: 20px; right: 20px; top: 50%;
            height: 2px;
            background: linear-gradient(90deg, #8E24AA, #d946ef);
            box-shadow: 0 0 10px rgba(217, 70, 239, 0.5);
            z-index: 0;
            opacity: 0.8;
        }
        .route-dot {
            position: relative;
            z-index: 10;
            background: #12081f;
            border: 1px solid #8E24AA;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(142, 36, 170, 0.3);
        }
        .route-pill {
            position: relative;
            z-index: 10;
            background: #05010a;
            border: 1px solid #373a45;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
            color: #d946ef;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #05010a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="text-white antialiased min-h-screen flex flex-col relative overflow-x-hidden selection:bg-brand-primary selection:text-white">

    <header class="sticky top-0 z-50 w-full border-b border-white/5 bg-[#05010a]/90 backdrop-blur-xl">
    <!--<div align="center"><h2>This is a TEST dapp and uses a TEST token. Do NOT use real money. Real launch will be later in Feb. 2026. Please follow the Socials linked below for latest updates</h2></div>-->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
        <div class="flex items-center gap-2 sm:gap-3">
            <img src="thenastrat_token_logo_white_gradient.png" alt="Icon" class="h-8 w-8 sm:h-10 sm:w-10">
            <span class="font-display font-bold text-lg sm:text-2xl tracking-tight bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">
                Thena Strategy
            </span>
        </div>
        <button id="connectBtn" onclick="connectWallet()"
            class="px-4 py-2 sm:px-6 sm:py-2.5 bg-gradient-to-r from-brand-primary to-brand-secondary rounded-xl font-bold text-xs sm:text-sm shadow-lg shadow-purple-900/20 hover:scale-105 hover:shadow-purple-900/40 transition-all duration-300 whitespace-nowrap">
            CONNECT WALLET
        </button>
    </div>
</header>


    <main class="flex-grow w-full px-4 sm:px-6 lg:px-8 py-6 sm:py-8 relative z-10">

        <div class="flex justify-center mb-8 sm:mb-12">
            <div class="flex p-1 bg-white/5 border border-white/5 rounded-full backdrop-blur-md relative">
                <button onclick="switchTab('swap')" id="tab-swap" class="relative px-6 sm:px-10 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-display font-bold transition-all duration-300 overflow-hidden bg-brand-primary text-white shadow-lg z-10">
                    Swap
                </button>
                <button onclick="switchTab('dashboard')" id="tab-dashboard" class="relative px-6 sm:px-10 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-display font-bold transition-all duration-300 text-gray-400 hover:text-white z-10">
                    Dashboard
                </button>
            </div>
        </div>

        <div class="relative w-full max-w-7xl mx-auto">


            <div id="swap-view" class="relative transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] opacity-100 translate-x-0 scale-100 z-10 origin-top">

                <div class="flex flex-col lg:flex-row justify-center items-start gap-7 mx-auto">


                    <div class="w-full lg:w-[460px] flex flex-col gap-7">

                        <div class="glass-panel rounded-[24px] p-4 sm:p-5 relative">

                            <div class="flex justify-between items-center mb-4 sm:mb-5">
                                <h2 class="text-lg sm:text-xl font-display font-bold text-white">Swap</h2>
                                <button onclick="toggleSettings()" class="text-gray-400 hover:text-white transition-colors">
                                    <svg id="settingsGear" class="w-5 h-5 rotate-gear" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                                </button>
                            </div>

                           <div id="settingsPanel" class="settings-container bg-black/40 rounded-xl border-white/5 border-0">
    <label class="text-[10px] text-gray-400 font-medium mb-2 block uppercase tracking-wide">Slippage Tolerance</label>
    <div class="flex gap-2">
        <button class="slip-option flex-1 py-2 rounded-lg text-xs font-bold border border-brand-border hover:bg-brand-primary/20 transition-colors" onclick="setSlip(12.0)">12%</button>
        <button class="slip-option flex-1 py-2 rounded-lg text-xs font-bold border border-brand-border hover:bg-brand-primary/20 transition-colors" onclick="setSlip(13.0)">13%</button>

        <input type="number" id="customSlip" placeholder="Custom %" class="flex-1 bg-transparent border border-brand-border rounded-lg text-center text-xs text-white focus:outline-none focus:border-brand-secondary transition-colors" oninput="setCustomSlip()">
    </div>
</div>
<div class="input-box rounded-2xl p-3.5 mb-1 relative group">
    <div class="flex justify-between mb-2 text-xs">
        <span class="text-gray-400 font-medium ml-1">Sell</span>
        <span class="text-gray-400">Bal: <span id="sBal" class="text-white font-mono">0.00</span> <span onclick="setMax()" class="cursor-pointer text-brand-accent hover:text-white ml-2 font-bold transition-colors">MAX</span></span>
    </div>
    <div class="flex items-center gap-3">
        <div class="flex-shrink-0 flex items-center gap-2 bg-white/5 px-3 py-1.5 rounded-full border border-white/5 hover:bg-white/10 transition-colors cursor-pointer">
            <img src="fBOMB_token_whiteblue_blackcircle.png" id="sIcon" class="w-5 h-5 sm:w-6 sm:h-6 rounded-full">
            <span id="sSym" class="font-display font-bold text-sm sm:text-base">fBOMB</span>
        </div>

        <button id="helpBtnSell" onclick="toggleAds()" class="sm:hidden flex items-center justify-center w-5 h-5 rounded-full bg-brand-primary/20 border border-brand-primary text-brand-secondary text-xs font-bold hover:bg-brand-primary hover:text-white transition-colors animate-pulse-glow" style="display: none;">
            ?
        </button>

        <input type="number" id="inpAmt" placeholder="0" oninput="calc()" class="flex-1 w-0 bg-transparent text-right font-display text-2xl sm:text-3xl font-bold placeholder-gray-700 focus:outline-none">
    </div>
    <div class="text-right text-[11px] text-gray-500 mt-2 font-mono pr-1" id="sUsd">$0.00</div>
</div>
<div class="relative h-2 flex items-center justify-center z-10">
    <button id="swapArrowBtn" onclick="toggleSwap()" class="absolute bg-[#12081f] border border-[#2d1b4e] p-2 rounded-lg text-brand-primary hover:text-white hover:bg-brand-primary hover:border-brand-primary transition-all duration-300 shadow-xl">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M12 5v14M5 12l7 7 7-7"/></svg>
    </button>
</div>
<div class="input-box rounded-2xl p-3.5 mt-1">
    <div class="flex justify-between mb-2 text-xs">
        <span class="text-gray-400 font-medium ml-1">Buy</span>
        <span class="text-gray-400">Bal: <span id="bBal" class="text-white font-mono">0.00</span></span>
    </div>
    <div class="flex items-center gap-3">
        <div class="flex-shrink-0 flex items-center gap-2 bg-white/5 px-3 py-1.5 rounded-full border border-white/5 hover:bg-white/10 transition-colors cursor-pointer">
            <img src="thenastrat_token_logo_white_gradient.png" id="bIcon" class="w-5 h-5 sm:w-6 sm:h-6 rounded-full">
            <span id="bSym" class="font-display font-bold text-sm sm:text-base">theSTRAT</span>
        </div>

        <button id="helpBtnBuy" onclick="toggleAds()" class="sm:hidden flex items-center justify-center w-5 h-5 rounded-full bg-brand-primary/20 border border-brand-primary text-brand-secondary text-xs font-bold hover:bg-brand-primary hover:text-white transition-colors animate-pulse-glow" style="display: none;">
            ?
        </button>

        <input type="text" id="outAmt" placeholder="0" readonly class="flex-1 w-0 bg-transparent text-right font-display text-2xl sm:text-3xl font-bold placeholder-gray-700 focus:outline-none cursor-default">
    </div>
    <div class="text-right text-[11px] text-gray-500 mt-2 font-mono pr-1" id="bUsd">$0.00</div>
</div>
                            <div class="mt-6 space-y-2 px-2">
                                <div class="flex justify-between text-xs font-medium">
        <span class="text-gray-500">Transfer Tax</span>
        <span class="text-brand-accent font-bold">10%</span>
    </div>
                                <div class="flex justify-between text-xs font-medium">
                                    <span class="text-gray-500">Rate</span>
                                    <span id="rateTxt" class="text-white">---</span>
                                </div>
                                <div class="flex justify-between text-xs font-medium">
                                    <span class="text-gray-500">Minimum Output</span>
                                    <span id="quoteTxt" class="text-white">---</span>
                                </div>
                            </div>

                            <button id="mainActionBtn" class="w-full mt-6 py-3.5 sm:py-4 bg-brand-primary hover:bg-brand-secondary rounded-xl font-display font-bold text-base sm:text-lg text-white shadow-lg shadow-brand-primary/30 hover:shadow-brand-primary/50 hover:translate-y-[-2px] active:translate-y-[0px] transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                CONNECT WALLET
                            </button>
                        </div>
                    </div>
                    <div class="w-full lg:w-[500px] flex flex-col gap-7">
                        <div class="glass-panel rounded-[24px] p-5 sm:p-6 h-full flex flex-col justify-between">

                            <div>
                                <div class="mb-6">
                                    <h3 id="cardPair" class="text-gray-400 font-display font-bold text-base sm:text-lg mb-1 tracking-wide">
                                    	theSTRAT / fBOMB
                                    	<span id="cardChange" class="mb-1 px-2 py-0.5 rounded text-xs font-bold bg-danger/10 text-danger border border-danger/20">-0.00%</span>
                                    </h3>
                                    <div class="flex items-end gap-3">
                                        <div id="cardPrice" class="text-4xl sm:text-5xl font-display font-extrabold text-white tracking-tight leading-none">
                                            $-.--
                                        </div>
                                    </div>
                                    <div class="flex items-end gap-1">
                                        <div id="cardPriceInTokens" class="text-xl sm:text-xl font-display font-extrabold text-white tracking-tight leading-none">
                                            -.-- fBOMB
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-3 sm:gap-4 mb-6">
                                    <div class="bg-black/30 p-3 sm:p-4 rounded-2xl border border-white/5">
                                        <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1">Market Cap</div>
                                        <div id="cardFdv" class="text-lg sm:text-xl font-display font-bold text-white">$0</div>
                                    </div>
                                    <div class="bg-black/30 p-3 sm:p-4 rounded-2xl border border-white/5">
                                        <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1">Liquidity</div>
                                        <div id="cardLiq" class="text-lg sm:text-xl font-display font-bold text-white">$0</div>
                                    </div>
                                </div>

                                <div class="bg-[#0a0510] border border-white/5 rounded-2xl p-4 sm:p-5 mb-4">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="text-[10px] uppercase tracking-widest text-gray-400 font-bold">Pool Composition</div>
                                        <div id="poolDonut" class="w-8 h-8 rounded-full" style="background: conic-gradient(#8E24AA 0% 50%, #ffffff 50% 100%); box-shadow: 0 0 15px rgba(142,36,170,0.3);">
                                            <div class="w-5 h-5 bg-[#0a0510] rounded-full absolute top-1.5 left-1.5"></div>
                                        </div>
                                    </div>

                                    <div class="flex flex-col gap-3">
                                        <div class="bg-[#0a0510] rounded-xl p-3 border border-white/5 flex flex-col gap-2">
                                            <div class="flex justify-between items-center">
                                                <div class="flex items-center gap-2">
                                                    <img src="thenastrat_token_logo_white_gradient.png" class="w-5 h-5">
                                                    <span class="text-xs font-bold text-gray-300">theSTRAT</span>
                                                </div>
                                                <span id="cVal1" class="font-mono text-xs text-white font-bold">---</span>
                                            </div>
                                            <div class="h-1 bg-gray-800 rounded-full overflow-hidden">
                                                <div id="bar1" class="h-full bg-brand-primary w-[50%] transition-all duration-500 shadow-[0_0_8px_#8E24AA]"></div>
                                            </div>
                                        </div>

                                        <div class="bg-[#0a0510] rounded-xl p-3 border border-white/5 flex flex-col gap-2">
                                            <div class="flex justify-between items-center">
                                                <div class="flex items-center gap-2">
                                                    <img src="fBOMB_token_whiteblue_blackcircle.png" class="w-5 h-5">
                                                    <span class="text-xs font-bold text-gray-300">fBOMB</span>
                                                </div>
                                                <span id="cVal2" class="font-mono text-xs text-white font-bold">---</span>
                                            </div>
                                            <div class="h-1 bg-gray-800 rounded-full overflow-hidden">
                                                <div id="bar2" class="h-full bg-white w-[50%] transition-all duration-500 shadow-[0_0_8px_white]"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="w-full bg-[#0a0510] border border-white/10 rounded-2xl p-4 mt-auto relative overflow-visible">
                                <div class="absolute -top-2.5 left-5 bg-[#0a0510] px-2 text-[9px] text-gray-500 font-bold uppercase tracking-widest z-20 border border-white/5 rounded-full">Smart Route</div>

                                <div class="route-path-container h-8 mt-1">
                                    <div class="route-line-bg"></div>
                                    <div class="route-line-active animate-pulse-glow"></div>
                                    <div class="route-dot w-7 h-7">
                                        <img src="thenastrat_token_logo_white_gradient.png" class="w-3.5 h-3.5 rounded-full">
                                    </div>
                                    <div class="route-pill shadow-[0_0_10px_rgba(217,70,239,0.3)] text-[9px] py-1 px-3">
                                        THENA
                                    </div>
                                    <div class="route-dot w-7 h-7" style="border-color: #d946ef; box-shadow: 0 0 15px rgba(217, 70, 239, 0.3);">
                                        <img src="fBOMB_token_whiteblue_blackcircle.png" class="w-3.5 h-3.5 rounded-full">
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div id="dashboard-view" class="absolute inset-0 transition-all duration-500 ease-[cubic-bezier(0.4,0,0.2,1)] opacity-0 translate-x-[20px] scale-95 pointer-events-none z-0">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full pb-8">

                    <div class="lg:col-span-2 flex flex-col gap-6">
                        <div class="glass-panel rounded-[24px] p-4 sm:p-6 min-h-[350px] lg:min-h-[450px] relative flex flex-col">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h2 class="font-display font-bold text-base sm:text-lg text-white">Price Performance</h2>
                                    <span class="text-xs text-gray-500">Last 30 Days</span>
                                </div>
                                <div class="text-right">
                                    <div id="dashPriceVal" class="text-xl sm:text-2xl font-bold font-display">$0.00</div>
                                    <div id="dashPriceChg" class="text-sm text-danger font-medium">-0.00%</div>
                                </div>
                            </div>
                            <div class="flex-grow w-full relative h-[250px] sm:h-[350px]">
                                <canvas id="priceChart"></canvas>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-brand-card border border-white/5 p-4 rounded-xl hover:bg-white/5 transition-colors">
                                <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1">Market Cap</div>
                                <div id="barMC" class="text-white font-bold font-display text-sm sm:text-base">---</div>
                            </div>
                            <div class="bg-brand-card border border-white/5 p-4 rounded-xl hover:bg-white/5 transition-colors">
                                <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1">Volume (24h)</div>
                                <div id="barVol" class="text-white font-bold font-display text-sm sm:text-base">---</div>
                            </div>
                            <div class="bg-brand-card border border-white/5 p-4 rounded-xl hover:bg-white/5 transition-colors">
                                <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1">Burned</div>
                                <div id="barBurn" class="text-white font-bold font-display text-sm sm:text-base">---</div>
                            </div>
                            <div class="bg-brand-card border border-white/5 p-4 rounded-xl hover:bg-white/5 transition-colors">
                                <div class="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1">Change</div>
                                <div id="barChg" class="text-white font-bold font-display text-sm sm:text-base">---</div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col gap-6">

                        <div class="bg-gradient-to-br from-brand-card to-[#2e1045] border border-brand-primary/30 rounded-[24px] p-5 sm:p-6 relative overflow-hidden group">
                            <div class="absolute top-[-50%] right-[-50%] w-64 h-64 bg-brand-accent/20 rounded-full blur-3xl group-hover:bg-brand-accent/30 transition-all duration-700"></div>

                            <div class="relative z-10">
                                <div class="text-[10px] uppercase tracking-widest text-gray-400 font-bold mb-2">Protocol Treasury</div>
                                <div id="repTotalValue" class="text-3xl sm:text-4xl font-display font-extrabold text-success mb-1 drop-shadow-lg">$0.00</div>
                                <div class="text-xs text-brand-secondary mb-6 font-medium">Estimated Intrinsic Value</div>

                                <div class="border-t border-white/10 pt-4 space-y-4">
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-400">eTHENA Staked</span>
                                        <span id="repStaked" class="font-mono font-bold text-white">0</span>
                                    </div>
                                    <div class="flex justify-between items-center text-sm">
                                        <span class="text-gray-400">veTHE Equivalent</span>
                                        <span id="repVe" class="font-mono font-bold text-white">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                       <div class="glass-panel rounded-[24px] p-5 sm:p-6">
    <div class="flex justify-between items-center mb-4">
        <span class="text-[10px] uppercase tracking-widest text-gray-400 font-bold">User Holdings</span>
        <span id="statusBadge" class="text-[10px] px-2 py-0.5 rounded bg-white/5 text-gray-400 font-medium border border-white/10">Not Connected</span>
    </div>

    <div class="bg-black/30 p-1 rounded-lg flex gap-1 mb-4">
        <button id="tabWallet" onclick="setQueryMode(false)" class="flex-1 py-1.5 text-xs font-semibold rounded-md bg-brand-primary text-white shadow-sm transition-all">My Wallet</button>
        <button id="tabQuery" onclick="setQueryMode(true)" class="flex-1 py-1.5 text-xs font-semibold rounded-md text-gray-400 hover:text-white hover:bg-white/5 transition-all">Query Mode</button>
    </div>

    <div id="queryWrap" class="relative mb-4 hidden animate-fade-in-up">
        <svg class="absolute left-3 top-3 w-4 h-4 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" id="queryInput" placeholder="Search 0xAddress..." oninput="handleQuery()" class="w-full bg-black/40 border border-white/10 rounded-lg py-2.5 pl-10 pr-3 text-xs font-mono text-white focus:border-brand-secondary focus:outline-none transition-colors">
    </div>

    <div class="flex flex-col gap-6 my-4">

        <div class="flex flex-col items-center justify-center">
            <div class="text-[10px] uppercase tracking-widest text-gray-500 font-bold mb-1">theSTRAT Balance</div>
            <div class="flex items-center gap-3">
                <span id="userWallet" class="text-4xl font-display font-bold text-white tracking-tight drop-shadow-[0_0_15px_rgba(142,36,170,0.5)]">0.00</span>
                <div class="flex items-center gap-1.5 bg-white/5 border border-white/10 px-2 py-1 rounded-lg">
                    <img src="thenastrat_token_logo_white_gradient.png" class="w-5 h-5 rounded-full">
                    <span class="text-[10px] font-bold text-brand-secondary">theSTRAT</span>
                </div>
            </div>
        </div>

        <div class="w-2/3 mx-auto h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>

    </div>

    <button onclick="copyAddress()" class="w-full mt-2 flex items-center justify-between px-4 py-3 bg-white/5 border border-dashed border-white/20 rounded-xl hover:bg-brand-primary/20 hover:border-brand-primary/50 hover:text-white text-gray-400 transition-all group">
        <span id="userAddrDisplay" class="font-mono text-xs">0x...</span>
        <svg class="w-3.5 h-3.5 group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
    </button>
</div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="relative z-10 mt-auto py-12 border-t border-white/5 bg-[#05010a]">
        <div class="flex justify-center gap-8 mb-8">
            <a href="https://x.com/ThenaStrategy" class="text-gray-500 hover:text-brand-accent hover:-translate-y-1 transition-all"><svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
            <a href="https://thenastrategy.gitbook.io/thena-strategy/" class="text-gray-500 hover:text-brand-accent hover:-translate-y-1 transition-all"><svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></a>
            <a href="https://t.me/ThenaStrategy" class="text-gray-500 hover:text-brand-accent hover:-translate-y-1 transition-all"><svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M21.93 3.53c-.36-.45-1.03-.54-1.55-.34L3.43 10.15c-.68.27-.69 1.14-.02 1.41l4.5 1.77 1.48 4.79c.14.47.74.55 1.01.16l2.12-3.08 4.4 3.39c.5.39 1.25.13 1.38-.5l2.67-13.5c.09-.46-.39-.92-.94-1.06zm-4.32 2.62l-7.6 6.8-.75-3.3 8.35-3.5z"/></svg></a>
        </div>
        <div class="flex justify-center items-center gap-2 text-xs text-gray-500 opacity-80 mt-4 mb-4">
            <span class="font-bold tracking-wide text-xs sm:text-xs">Powered by</span>
        </div>
        <div class="flex justify-center items-center gap-2 text-l text-gray-500 opacity-80">
	        <img onclick="window.open('https://mclb.org')"  src="mclb.svg" alt="Thena" class="w-4 h-4 hover:scale-110 transition-transform">
	        <span onclick="window.open('https://mclb.org')" class="font-bold tracking-wide">Millennium Club</span>
	        <img onclick="window.open('https://thena.fi')"  src="https://thena.fi/favicon/apple-touch-icon.png" alt="Thena" class="w-4 h-4 hover:scale-110 transition-transform">
	        <span onclick="window.open('https://thena.fi')"  class="font-bold tracking-wide">THENA.fi</span>
	        <img onclick="window.open('https://eliteness.network')"  src="https://ftm.guru/icons/eliteness.png" alt="Thena" class="w-4 h-4 hover:scale-110 transition-transform">
	        <span onclick="window.open('https://eliteness.network')"  class="font-bold tracking-wide">Eliteness Network</span>
        </div>
    </footer>

    <div id="toastContainer" class="fixed top-24 right-5 z-[100] flex flex-col gap-3 pointer-events-none max-w-sm w-full"></div>

    <div id="swapModal" class="fixed inset-0 z-[999] bg-black/80 backdrop-blur-sm hidden flex justify-center items-center opacity-0 transition-opacity duration-300">
        <div class="bg-[#1a0b2e] border border-brand-primary w-[90%] max-w-sm p-8 rounded-3xl text-center shadow-[0_0_50px_rgba(142,36,170,0.3)] transform scale-95 transition-transform duration-300 relative">
            <div id="modalSpinner" class="w-12 h-12 border-4 border-white/10 border-t-brand-primary rounded-full animate-spin mx-auto mb-6"></div>

            <svg id="modalSuccess" class="hidden w-16 h-16 text-success mx-auto mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
            <svg id="modalError" class="hidden w-16 h-16 text-danger mx-auto mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>

            <div class="text-xl font-display font-bold text-white mb-2" id="modalTitle">Processing...</div>
            <div class="text-sm text-gray-400 mb-6" id="modalDesc">Please confirm transaction in your wallet</div>

            <button id="modalCloseBtn" class="hidden bg-white/5 border border-white/10 text-white px-6 py-2 rounded-lg hover:bg-white/10 transition-colors" onclick="hideModal()">Close</button>
        </div>
    </div>

<div id="leftAdBox" class="hidden sm:block fixed bottom-5 left-5 w-64 bg-brand-card/95 backdrop-blur-xl border border-brand-primary/20 rounded-2xl p-4 shadow-[0_0_30px_rgba(0,0,0,0.5)] z-50 transition-all hover:-translate-y-1">
    <button class="absolute top-2 right-2 text-gray-500 hover:text-white text-xs" onclick="toggleAds()">✕</button>
    <div class="flex gap-3 items-center mb-3">
        <img src="fBOMB_token_whiteblue_blackcircle.png" class="w-10 h-10 rounded-full bg-white/10">
        <div class="font-bold text-sm leading-tight text-white">Need<br>fBOMB?</div>
    </div>
    <div class="space-y-2">
        <a href="https://thena.fi/swap?outputCurrency=0x74ccbe53F77b08632ce0CB91D3A545bF6B8E0979" target="_blank" class="block text-center text-[10px] font-bold bg-white/5 hover:bg-brand-primary text-white py-2 rounded-lg transition-colors">Buy on THENA</a>
        <a href="https://mclb.org/bridge" target="_blank" class="block text-center text-[10px] font-bold bg-white/5 hover:bg-brand-secondary text-white py-2 rounded-lg transition-colors">Bridge from MCLB.org</a>
    </div>
</div>

    <div id="mobileInfoBtn" class="hidden" onclick="toggleAds()"></div>

    <script>
        const ADDR_ROUTER   = "0xd4ae6eca985340dd434d38f470accce4dc78d109";
        const ADDR_THESTRAT = "0x31fCA0083A2b0b99aB044EB21625ACC6Ed87e4fe";//"0x28da45415B602B69b97DE6CF6aA75458358e270c";//"0x0e5eb3a3c1cf4d46fDedAD88D481A284b0496B4C";
        const ADDR_FBOMB    = "0x74ccbe53F77b08632ce0CB91D3A545bF6B8E0979";
        const ADDR_WBNB     = "0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c";
        const ADDR_TREASURY = "0x28aa4f9ffe21365473b64c161b566c3cdead0108";
        const ADDR_MSIG     = "0x5053776B2111809AA4b308F1F6417E65f8aABa1E";
        const ADDR_GAUGE    = "0xce6b9bae3c330e0455d1af0ae3996f496cdbf1f1";//ethena/wbnb gauge
        const ADDR_LP_PAIR  = "0x3d63abc40402d0f7291917A85E0E4c46Fb1A37b4";//"0x54d67ef39ad989debc4dd73f0f9115c651a5c994";//"0x7309c3e4c48327E24f6641625afb5e4636704b80";//"0x7245D36825acFE58dE64E1b4A5F6d95662628faA";
        const ADDR_ETHENA   = "0xafbe3b8b0939a5538DE32f7752A78e08C8492295";
        const ADDR_THE      = "0xF4C8E32EaDEC4BFe97E0F595AdD0f4450a863a11";
        const ADDR_VETHE    = "0xfBBF371C9B0B994EebFcC977CEf603F7f31c070D";

        let VETHE_RATIO = 2.50;
        const BSC_RPC = "https://bsc-dataseed.binance.org/";

        const IMG_BOMB = "fBOMB_token_whiteblue_blackcircle.png";
        const IMG_THESTRAT = "thenastrat_token_logo_white_gradient.png";

        const MINIMAL_STRAT_ABI = ["function approve(address spender, uint256 amount) external returns (bool)","function allowance(address owner, address spender) external view returns (uint256)","function decimals() external view returns (uint8)","function balanceOf(address account) external view returns (uint256)","function totalSupply() external view returns (uint256)"];
        const ROUTER_ABI = ["function getAmountsOut(uint amountIn, tuple(address from, address to, bool stable)[] memory routes) public view returns (uint[] memory amounts)","function swapExactTokensForTokensSupportingFeeOnTransferTokens(uint amountIn, uint amountOutMin, tuple(address from, address to, bool stable)[] calldata routes, address to, uint deadline) external"];
        const ERC20_ABI = ["function approve(address spender, uint256 amount) external returns (bool)","function allowance(address owner, address spender) external view returns (uint256)","function decimals() external view returns (uint8)","function balanceOf(address account) external view returns (uint256)"];
        const STAKING_ABI = ["function balanceOf(address account) external view returns (uint256)","function earned(address account, address _rewardsToken) external view returns (uint256)","function totalSupply() external view returns (uint256)"];
        const PAIR_ABI = ["function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)","function totalSupply() external view returns (uint256)","function token0() external view returns (address)","function token1() external view returns (address)"];
        const VETHE_ABI = ["function tokenOfOwnerByIndex(address owner, uint256 index) external view returns (uint256)","function locked(uint256 id) external view returns (int128 amount, uint256 end)","function balanceOf(address owner) external view returns (uint256)"];

        let provider, signer, userAddr;
        let pair = null;
        let isBuy = true;
        let slippage = 12.0;
        let quoteTimeout = null;
        let chartInstance = null;
        let queryTimeout = null;
        let isQueryMode = false;

        function switchTab(t) {
    const swapBtn = document.getElementById('tab-swap');
    const dashBtn = document.getElementById('tab-dashboard');
    const swapView = document.getElementById('swap-view');
    const dashView = document.getElementById('dashboard-view');

    const activeClass = ['bg-brand-primary', 'text-white', 'shadow-lg'];
    const inactiveClass = ['text-gray-400', 'hover:text-white'];

    const removePosClasses = (el) => {
        el.classList.remove('translate-x-[20px]', 'translate-x-[-20px]', 'translate-x-0', 'opacity-0', 'opacity-100', 'pointer-events-none', 'scale-95', 'scale-100', 'absolute', 'relative', 'z-0', 'z-10');
    };

    if(t === 'swap') {
        swapBtn.classList.add(...activeClass);
        swapBtn.classList.remove(...inactiveClass);
        dashBtn.classList.remove(...activeClass);
        dashBtn.classList.add(...inactiveClass);

        removePosClasses(swapView);
        swapView.classList.add('opacity-100', 'translate-x-0', 'z-10', 'scale-100', 'relative');

        removePosClasses(dashView);
        dashView.classList.add('opacity-0', 'translate-x-[20px]', 'pointer-events-none', 'scale-95', 'absolute', 'z-0');
    } else {
        dashBtn.classList.add(...activeClass);
        dashBtn.classList.remove(...inactiveClass);
        swapBtn.classList.remove(...activeClass);
        swapBtn.classList.add(...inactiveClass);

        removePosClasses(dashView);
        dashView.classList.add('opacity-100', 'translate-x-0', 'z-10', 'scale-100', 'relative');

        removePosClasses(swapView);
        swapView.classList.add('opacity-0', 'translate-x-[-20px]', 'pointer-events-none', 'scale-95', 'absolute', 'z-0');

        updateDashboard();
        fetchUserStats();
        setTimeout(() => { if(chartInstance) renderPriceChart(); else renderPriceChart(); }, 300);
    }
}
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const gear = document.getElementById('settingsGear');
            panel.classList.toggle('open');
            gear.classList.toggle('active');
        }

        function setSlip(val) {
            slippage = val;
            document.getElementById('customSlip').value = "";
            updateSlipUI();
        }

        function setCustomSlip() {
            const val = parseFloat(document.getElementById('customSlip').value);
            if(!isNaN(val)) slippage = val;
            updateSlipUI();
        }

        function updateSlipUI() {
            document.querySelectorAll('.slip-option').forEach(b => {
                const isActive = parseFloat(b.innerText) === slippage && document.getElementById('customSlip').value === "";
                if(isActive) {
                    b.classList.add('bg-brand-primary', 'text-white', 'border-transparent');
                    b.classList.remove('border-brand-border');
                } else {
                    b.classList.remove('bg-brand-primary', 'text-white', 'border-transparent');
                    b.classList.add('border-brand-border');
                }
            });
            calc();
        }

        function copyAddress() {
            if(!userAddr) return alert("Connect Wallet first");
            navigator.clipboard.writeText(userAddr);
            showToast("Address Copied", "success");
        }

        function setQueryMode(enabled) {
            isQueryMode = enabled;
            const wrap = document.getElementById('queryWrap');
            const tabW = document.getElementById('tabWallet');
            const tabQ = document.getElementById('tabQuery');

            if(enabled) {
                wrap.classList.remove('hidden');
                tabW.classList.remove('bg-brand-primary', 'text-white');
                tabW.classList.add('text-gray-400', 'hover:text-white');

                tabQ.classList.add('bg-brand-primary', 'text-white');
                tabQ.classList.remove('text-gray-400');

                document.getElementById('balanceLabel').innerText = "Query Balance";
                document.getElementById('userWallet').innerText = "0.00";
            } else {
                wrap.classList.add('hidden');
                tabW.classList.add('bg-brand-primary', 'text-white');
                tabQ.classList.remove('bg-brand-primary', 'text-white');
                tabQ.classList.add('text-gray-400');

                document.getElementById('queryInput').value = "";
                document.getElementById('balanceLabel').innerText = "Balance";
                fetchUserStats();
            }
        }

        function handleQuery() {
            clearTimeout(queryTimeout);
            queryTimeout = setTimeout(() => { fetchUserStats(); }, 500);
        }

        function showToast(msg, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            let borderColor = type === 'success' ? 'border-success' : (type === 'error' ? 'border-danger' : 'border-brand-primary');
            toast.className = `bg-[#140a1e] border-l-4 ${borderColor} text-white px-5 py-3 rounded-md shadow-2xl flex items-center gap-3 transform transition-all duration-300 translate-x-full opacity-0`;

            let icon = type === 'success' ? '✓' : (type === 'error' ? '✕' : 'ℹ');
            toast.innerHTML = `<span class="font-bold text-lg">${icon}</span> <span class="text-sm font-medium">${msg}</span>`;

            container.appendChild(toast);
            requestAnimationFrame(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
            });
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function showModal(title, desc) {
            const modal = document.getElementById('swapModal');
            document.getElementById('modalSpinner').style.display = 'block';
            document.getElementById('modalSuccess').classList.add('hidden');
            document.getElementById('modalError').classList.add('hidden');
            document.getElementById('modalCloseBtn').classList.add('hidden');
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalDesc').innerText = desc;

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95');
                modal.querySelector('div').classList.add('scale-100');
            }, 10);
        }

        function setModalError(errMsg) {
            document.getElementById('modalSpinner').style.display = 'none';
            document.getElementById('modalError').classList.remove('hidden');
            document.getElementById('modalTitle').innerText = "Failed";
            document.getElementById('modalDesc').innerText = errMsg;
            document.getElementById('modalCloseBtn').classList.remove('hidden');
            document.getElementById('modalCloseBtn').style.display = 'inline-block';
        }

        function setModalSuccess(txHash) {
            document.getElementById('modalSpinner').style.display = 'none';
            document.getElementById('modalSuccess').classList.remove('hidden');
            document.getElementById('modalTitle').innerText = "Success";
            document.getElementById('modalDesc').innerText = "Transaction confirmed";
            document.getElementById('modalCloseBtn').classList.remove('hidden');
            document.getElementById('modalCloseBtn').style.display = 'inline-block';
        }
        function hideModal() {
            const modal = document.getElementById('swapModal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.remove('scale-100');
            modal.querySelector('div').classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        async function connectWallet() {
            if(!window.ethereum) return showToast("Install MetaMask", "error");
            try {
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                userAddr = await signer.getAddress();

                const net = await provider.getNetwork();
                if(net.chainId !== 56n) {
                    try { await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] }); }
                    catch(e) { return showToast("Switch to BSC", "error"); }
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                }

                document.getElementById('connectBtn').innerHTML = `${userAddr.substring(0,6)}...${userAddr.substring(38)}`;
                document.getElementById('mainActionBtn').innerText = "SWAP";

                const badge = document.getElementById('statusBadge');
                badge.innerText = "Connected";
                badge.className = "text-[10px] px-2 py-0.5 rounded bg-success/20 text-success font-medium border border-success/30";
                document.getElementById('userAddrDisplay').innerText = userAddr.substring(0,8) + "..." + userAddr.substring(36);

                showToast("Wallet Connected", "success");
                calc();
                updateDashboard();
                fetchSwapBalances();
                if(isQueryMode) handleQuery(); else fetchUserStats();

            } catch (e) { console.error(e); showToast("Connection failed", "error"); }
        }

        async function init() {
    try {
        if(!provider) provider = new ethers.JsonRpcProvider(BSC_RPC);

        updateSlipUI();

        updateDashboard();
            } catch(e) { console.log("Init RPC error:", e); }

            try {
                //const res = await fetch("https://api.dexscreener.com/latest/dex/search?q=fbomb%20ethena");
                const res = await fetch("https://api.dexscreener.com/latest/dex/pairs/bsc/" + ADDR_LP_PAIR);
                const data = await res.json();
                if(data.pairs && data.pairs.length) {
                    pair = data.pairs[0];
                    pair.baseToken.symbol = "theSTRAT";
                    updateAllUI();
                    renderPriceChart();
                }
            } catch(e) {}
        }

        async function updateDashboard() {
            if(!provider) return;
            try {
                const gaugeContract = new ethers.Contract(ADDR_GAUGE, STAKING_ABI, provider);
                const pairContract = new ethers.Contract(ADDR_LP_PAIR, PAIR_ABI, provider);
                const wbnbContract = new ethers.Contract(ADDR_WBNB, ERC20_ABI, provider);
                const ethenaContract = new ethers.Contract(ADDR_ETHENA, MINIMAL_STRAT_ABI, provider);
                const veTheContract = new ethers.Contract(ADDR_VETHE, VETHE_ABI, provider);

                const etSupplyWei = await ethenaContract.totalSupply();
                const etSupply = parseFloat(ethers.formatUnits(etSupplyWei, 18));
                const veBalance = await veTheContract.balanceOf(ADDR_ETHENA);
                let totalVeLocked = 0;
                if (Number(veBalance) > 0) {
                    const tokenId = await veTheContract.tokenOfOwnerByIndex(ADDR_ETHENA, 0);
                    const lockedStruct = await veTheContract.locked(tokenId);
                    totalVeLocked = parseFloat(ethers.formatUnits(lockedStruct[0], 18));
                }
                if (etSupply > 0 && totalVeLocked > 0) { VETHE_RATIO = totalVeLocked / etSupply; }

                const stakedLPWei = await gaugeContract.balanceOf(ADDR_TREASURY);
                const stakedLP = parseFloat(ethers.formatUnits(stakedLPWei, 18));
                const totalLPSupplyWei = await pairContract.totalSupply();
                const totalLP = parseFloat(ethers.formatUnits(totalLPSupplyWei, 18));
                const reserves = await pairContract.getReserves();
                const reserveEthenaWei = reserves[1];
                const totalEthenaPool = parseFloat(ethers.formatUnits(reserveEthenaWei, 18));
                const poolShare = stakedLP / totalLP;
                const myEthena = totalEthenaPool * poolShare;
                const myVeThe = myEthena * VETHE_RATIO;

                const elemStaked = document.getElementById('repStaked');
                if(elemStaked) elemStaked.innerHTML = myEthena.toLocaleString(undefined, {maximumFractionDigits:0});
                const elemVe = document.getElementById('repVe');
                if(elemVe) elemVe.innerHTML = myVeThe.toLocaleString(undefined, {maximumFractionDigits:0});

                try {
                    const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${ADDR_THE}`);
                    const data = await res.json();
                    if(data.pairs && data.pairs.length > 0) {
                        const priceOfThe = parseFloat(data.pairs[0].priceUsd);
                        const totalIntrinsicValue = myVeThe * priceOfThe;
                        const elemTotal = document.getElementById('repTotalValue');
                        if(elemTotal) elemTotal.innerText = fmtUSD(totalIntrinsicValue);
                    }
                } catch(e) {}

            } catch(e) { console.error("Dashboard Update Error:", e); }
        }

        function renderPriceChart() {
            if(chartInstance) chartInstance.destroy();
            const ctx = document.getElementById('priceChart').getContext('2d');

            const brandColor = "#8E24AA";
            const textColor = "#B39DDB";

            let currentPrice = pair ? parseFloat(pair.priceUsd) : 0.1732;
            let dataPoints = [];
            let labels = [];
            let val = currentPrice * 0.85;
            for(let i=0; i<30; i++) {
                labels.push("");
                let change = (Math.random() - 0.4) * (currentPrice * 0.05);
                val += change;
                if(i===29) val = currentPrice;
                dataPoints.push(val);
            }
            document.getElementById('dashPriceVal').innerText = "$" + currentPrice.toFixed(6);

            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(142, 36, 170, 0.5)');
            gradient.addColorStop(1, 'rgba(142, 36, 170, 0)');

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Price',
                        data: dataPoints,
                        borderColor: brandColor,
                        backgroundColor: gradient,
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: true, mode: 'index', intersect: false, backgroundColor: '#12081f', titleColor: '#fff', bodyColor: '#fff', borderColor:'#8E24AA', borderWidth:1 } },
                    scales: {
                        x: { display: false },
                        y: { display: true, position:'right', grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { callback: function(value){ return '$' + value.toFixed(4); }, font:{family:'Inter'}, color: textColor } }
                    },
                    interaction: { mode: 'nearest', axis: 'x', intersect: false }
                }
            });
        }

       async function fetchUserStats() {
            if(!provider) return;
            let targetAddr = userAddr;

            if(isQueryMode) {
                const inputVal = document.getElementById('queryInput').value;
                if(ethers.isAddress(inputVal)) {
                    targetAddr = inputVal;
                } else {
                    document.getElementById('userWallet').innerText = "---";
                    document.getElementById('userEthena').innerText = "---";
                    return;
                }
            } else {
                if(!userAddr) return;
            }

            try {
                const tokenContract = new ethers.Contract(ADDR_THESTRAT, MINIMAL_STRAT_ABI, provider);
                const walletWei = await tokenContract.balanceOf(targetAddr);
                document.getElementById('userWallet').innerText = parseFloat(ethers.formatUnits(walletWei, 18)).toFixed(2);

                const ethenaContract = new ethers.Contract(ADDR_ETHENA, MINIMAL_STRAT_ABI, provider);
                const ethenaWei = await ethenaContract.balanceOf(targetAddr);
                const ethenaEl = document.getElementById('userEthena');
                if(ethenaEl) {
                    ethenaEl.innerText = parseFloat(ethers.formatUnits(ethenaWei, 18)).toFixed(2);
                }

            } catch(e) { console.log("User stats error", e); }
        }

        async function fetchSwapBalances() {
            if(!userAddr || !provider) return;
            try {
                const tIn = isBuy ? ADDR_FBOMB : ADDR_THESTRAT;
                const tOut = isBuy ? ADDR_THESTRAT : ADDR_FBOMB;
                const cIn = new ethers.Contract(tIn, MINIMAL_STRAT_ABI, provider);
                const cOut = new ethers.Contract(tOut, MINIMAL_STRAT_ABI, provider);
                const [bIn, bOut] = await Promise.all([ cIn.balanceOf(userAddr), cOut.balanceOf(userAddr) ]);
                const bInFmt = ethers.formatUnits(bIn, 18);
                const bOutFmt = ethers.formatUnits(bOut, 18);

                document.getElementById('sBal').innerText = parseFloat(bInFmt).toFixed(4);
                document.getElementById('sBal').dataset.raw = bInFmt;
                document.getElementById('bBal').innerText = parseFloat(bOutFmt).toFixed(4);
            } catch(e) { console.log("Swap balance fetch error", e); }
        }

        function setMax() {
            const raw = document.getElementById('sBal').dataset.raw;
            if(raw) { document.getElementById('inpAmt').value = raw; calc(); }
        }

        function updateAllUI() {
            if(!pair) return;
            document.getElementById('cardPair').innerText = `theSTRAT / ${pair.quoteToken.symbol}`;
            document.getElementById('cardPrice').innerText = "$" + parseFloat(pair.priceUsd).toFixed(8);
            document.getElementById('cardPriceInTokens').innerText = parseFloat(pair.priceNative).toFixed(8) + " fBOMB";
            const chg = pair.priceChange.h24;
            if(chg) {
            	const chgEl = document.getElementById('cardChange');
            	chgEl.innerText = (chg >= 0 ? "+" : "-") + chg + "%";
            	chgEl.className = chg >= 0 ? "mb-2 px-3 py-1 rounded-lg text-sm font-bold bg-success/10 text-success border border-success/20" : "mb-2 px-3 py-1 rounded-lg text-sm font-bold bg-danger/10 text-danger border border-danger/20";
            	document.getElementById('dashPriceChg').innerText = (chg >= 0 ? "+" : "-") + chg + "%";
            	document.getElementById('dashPriceChg').className = chg >= 0 ? "text-sm text-success font-medium" : "text-sm text-danger font-medium";
            }

            document.getElementById('cardFdv').innerText = fmtUSD(pair.fdv);
            document.getElementById('cardLiq').innerText = fmtUSD(pair.liquidity.usd);

            const liqBase = pair.liquidity.base;
            const liqQuote = pair.liquidity.quote;

            document.getElementById('cVal1').innerText = fmtNum(liqBase);
            document.getElementById('cVal2').innerText = fmtNum(liqQuote);

            document.getElementById('barMC').innerText = fmtUSD(pair.fdv);
            document.getElementById('barVol').innerText = fmtUSD(pair.volume.h24);
            document.getElementById('barBurn').innerText = "0";
            document.getElementById('barChg').innerText = (chg >= 0 ? "+" : "") + chg + "%";
            document.getElementById('barChg').className = chg >= 0 ? "text-success font-bold font-display" : "text-danger font-bold font-display";

            updateSwapInputs();
        }

function updateSwapInputs() {
    const tStrat = { sym: "theSTRAT", name: "Thena Strategy", icon: IMG_THESTRAT };
    const tBomb = { sym: "fBOMB", name: "fBOMB", icon: IMG_BOMB };

    const tin = isBuy ? tBomb : tStrat;
    const tout = isBuy ? tStrat : tBomb;

    document.getElementById('sSym').innerText = tin.sym;
    document.getElementById('sIcon').src = tin.icon;

    document.getElementById('bSym').innerText = tout.sym;
    document.getElementById('bIcon').src = tout.icon;

    const btnSell = document.getElementById('helpBtnSell');
    const btnBuy = document.getElementById('helpBtnBuy');

    if(btnSell) {
        btnSell.style.display = (tin.sym === 'fBOMB') ? 'flex' : 'none';
    }
    if(btnBuy) {
        btnBuy.style.display = (tout.sym === 'fBOMB') ? 'flex' : 'none';
    }

    fetchSwapBalances();
    calc();
}

function toggleAds() {
    const el = document.getElementById('leftAdBox');

    const isHidden = el.style.display === 'none' || el.classList.contains('hidden');

    if (isHidden) {
        el.classList.remove('hidden');
        el.style.display = '';
    } else {
        el.classList.add('hidden');
        el.style.display = 'none';
    }
}

       function toggleSwap() {
    isBuy = !isBuy;
    document.getElementById('inpAmt').value = "";
    document.getElementById('outAmt').value = "";
        document.getElementById('swapArrowBtn').classList.toggle('rotate-180');

    updateSwapInputs();
}

        async function getBestRoute(amountInWei, tokenIn, tokenOut, routerContract) {
            const routeDir = [{ from: tokenIn, to: tokenOut, stable: false }];
            try { const amounts = await routerContract.getAmountsOut(amountInWei, routeDir); return { route: routeDir, amounts }; } catch (e) { }
            const routeWbnb = [{ from: tokenIn, to: ADDR_WBNB, stable: false }, { from: ADDR_WBNB, to: tokenOut, stable: false }];
            try { const amounts = await routerContract.getAmountsOut(amountInWei, routeWbnb); return { route: routeWbnb, amounts }; } catch (e) {}
            throw new Error("No Liquidity");
        }

        function calc() {
            const val = parseFloat(document.getElementById('inpAmt').value);
            if(!val || val<=0) {
                document.getElementById('outAmt').value = "";
                document.getElementById('quoteTxt').innerText = "---";
                document.getElementById('bUsd').innerHTML = "$0.00";
                document.getElementById('sUsd').innerHTML = "$0.00";
                return;
            }
            if(!provider) { document.getElementById('outAmt').placeholder = "Connect"; return; }

            clearTimeout(quoteTimeout);
            quoteTimeout = setTimeout(async () => {
                try {
                    const router = new ethers.Contract(ADDR_ROUTER, ROUTER_ABI, provider);
                    const tokenIn = isBuy ? ADDR_FBOMB : ADDR_THESTRAT;
                    const tokenOut = isBuy ? ADDR_THESTRAT : ADDR_FBOMB;
                    const inAbi = (tokenIn === ADDR_THESTRAT) ? MINIMAL_STRAT_ABI : ERC20_ABI;
                    const outAbi = (tokenOut === ADDR_THESTRAT) ? MINIMAL_STRAT_ABI : ERC20_ABI;
                    const tokenContract = new ethers.Contract(tokenIn, inAbi, provider);
                    const outContract = new ethers.Contract(tokenOut, outAbi, provider);
                    const decimals = await tokenContract.decimals();
                    const outDecimals = await outContract.decimals();
                    const amountInWei = ethers.parseUnits(val.toString(), decimals);
                    const res = await getBestRoute(amountInWei, tokenIn, tokenOut, router);
                    const amountOutWei = res.amounts[res.amounts.length - 1];
                    const rawAmtOut = parseFloat(ethers.formatUnits(amountOutWei, outDecimals));
const slipFactor = (100 - slippage) / 100;
const minReceived = rawAmtOut * slipFactor;

document.getElementById('outAmt').value = minReceived.toFixed(6);

document.getElementById('quoteTxt').innerText = minReceived.toFixed(6);

document.getElementById('rateTxt').innerText = `1 ${isBuy?'fBOMB':'theSTRAT'} = ${(rawAmtOut/val).toFixed(4)} ${isBuy?'theSTRAT':'fBOMB'}`;

const priceIn = isBuy ? (parseFloat(pair.priceUsd)/parseFloat(pair.priceNative)) : parseFloat(pair.priceUsd);
document.getElementById('sUsd').innerText = fmtUSD(val * priceIn);

const priceOut = isBuy ? parseFloat(pair.priceUsd) : (parseFloat(pair.priceUsd)/parseFloat(pair.priceNative));
document.getElementById('bUsd').innerText = fmtUSD(rawAmtOut * priceOut);
                    document.getElementById('rateTxt').innerText = `1 ${isBuy?'fBOMB':'theSTRAT'} = ${(rawAmtOut/val).toFixed(4)} ${isBuy?'theSTRAT':'fBOMB'}`;
                    document.getElementById('quoteTxt').innerText = minReceived.toFixed(6);
                } catch(e) { console.log(e); }
            }, 500);
        }

        document.getElementById('mainActionBtn').addEventListener('click', async () => {
            if(!userAddr) return connectWallet();
            const btn = document.getElementById('mainActionBtn');
            const val = document.getElementById('inpAmt').value;

            if(!val) return showToast("Enter Amount", "error");
            showModal("Swapping", "Confirm transaction in wallet...");

            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                const tokenIn = isBuy ? ADDR_FBOMB : ADDR_THESTRAT;
                const tokenOut = isBuy ? ADDR_THESTRAT : ADDR_FBOMB;
                const inAbi = (tokenIn === ADDR_THESTRAT) ? MINIMAL_STRAT_ABI : ERC20_ABI;

                const tokenContract = new ethers.Contract(tokenIn, inAbi, signer);
                const routerContract = new ethers.Contract(ADDR_ROUTER, ROUTER_ABI, signer);

                const decimals = await tokenContract.decimals();
                const amountInWei = ethers.parseUnits(val.toString(), decimals);

                document.getElementById('modalTitle').innerText = "Approving";
                const allowance = await tokenContract.allowance(userAddr, ADDR_ROUTER);

                if(allowance < amountInWei) {
                    const txApp = await tokenContract.approve(ADDR_ROUTER, ethers.MaxUint256);
                    await txApp.wait();
                }

                document.getElementById('modalTitle').innerText = "Confirm Swap";
                const routeRes = await getBestRoute(amountInWei, tokenIn, tokenOut, routerContract);
                const expectedOut = routeRes.amounts[routeRes.amounts.length-1];
                const minOut = (expectedOut * BigInt((100 - slippage)*100)) / 10000n;
                const deadline = Math.floor(Date.now()/1000) + 600;

                const tx = await routerContract.swapExactTokensForTokensSupportingFeeOnTransferTokens(
                    amountInWei, minOut, routeRes.route, userAddr, deadline, { gasLimit: 500000 }
                );

                document.getElementById('modalTitle').innerText = "Pending";
                await tx.wait();

                setModalSuccess(tx.hash);
                showToast("Swap Successful", "success");
                fetchSwapBalances(); calc();
            } catch(e) {
                console.error(e);
                let errorMsg = "Transaction failed";
                if(e.message.includes("User denied")) errorMsg = "Rejected by user";
                setModalError(errorMsg);
                showToast("Failed", "error");
            }
            btn.innerText = "SWAP";
            btn.disabled = false;
        });


        function fmtUSD(n) { return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:0}).format(n); }
        function fmtNum(n) { return new Intl.NumberFormat('en-US',{maximumFractionDigits:0}).format(n); }

        init();
    </script>
</body>
</html>
